name: Sync Fork with Upstream

on:
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Check out the code
        uses: actions/checkout@v2

      - name: Set up Git
        run: |
          git config --global user.name ${{ secrets.githubUserName }}
          git config --global user.email ${{ secrets.githubEmail }}

      - name: Fetch Upstream
        run: |
          # Replace 'upstream' with the name of the upstream repository
          git remote add upstream https://github.com/mike9014/workflow-tests.git
          git remote -v
          git fetch upstream

      - name: Create Sync Branch
        run: |
          # Create a new branch for the sync
          git checkout -b sync-branch upstream/main
          git push origin sync-branch

      - name: Create Pull Request
        run: |
          # Replace with your desired title and body for the pull request
          PR_TITLE="Sync with Upstream"
          PR_BODY="This pull request updates the fork to match the latest changes from the upstream repository."
          GIT_BRANCH=${GITHUB_REF#refs/heads/}
          # Create the pull request
          gh pr create --base "$GIT_BRANCH" --fill --head sync-branch --title "$PR_TITLE" --body "$PR_BODY"
        env:
         GITHUB_TOKEN: ${{ secrets.CODEFLARE_MACHINE_ACCOUNT_TOKEN }}
        shell: bash
          
