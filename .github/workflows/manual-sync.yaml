name: Sync Fork with Upstream

on:
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Check out the code
        uses: actions/checkout@v2

      - name: Set up Git
        run: |
          git config --global user.name ${{ secrets.githubUserName }}
          git config --global user.email ${{ secrets.githubEmail }}

      - name: Merge main branch
        run: |
          git checkout -b sync-branchs
          git remote add fork https://github.com/mike9014/workflow-tests.git
          git fetch fork
          git merge fork/main
          git push origin sync-branchs

      - name: Create Pull Request
        run: |
          PR_TITLE="Sync with Upstream"
          PR_BODY="This pull request updates the fork to match the latest changes from the upstream repository."
          GIT_BRANCH=${GITHUB_REF#refs/heads/}
          gh pr create --base "$GIT_BRANCH" --fill --head sync-branch --title "$PR_TITLE" --body "$PR_BODY"
        env:
         GITHUB_TOKEN: ${{ secrets.CODEFLARE_MACHINE_ACCOUNT_TOKEN }}
        shell: bash
          
